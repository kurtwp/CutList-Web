<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Wood Cutting Optimizer</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        canvas {
            touch-action: none;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center p-4 min-h-screen">
<div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-3xl">
<h1 class="text-3xl font-bold text-center text-gray-800 mb-2 md:mb-4">Wood Cutting Optimizer</h1>
<p class="text-sm text-center text-gray-500 italic mb-4">All cut calculations use a kerf (blade thickness) of 1/8 inch.</p>
<!-- Message Box -->
<div class="hidden p-3 mb-4 text-center text-sm font-medium rounded-lg" id="messageBox" role="alert"></div>
<div class="space-y-6 md:space-y-8">
<div class="flex flex-col md:flex-row md:items-end space-y-4 md:space-y-0 md:space-x-6">
<label class="block text-gray-700 font-semibold md:w-1/2" for="stockLength">
                    Stock Board Length (inches):
                    <input class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition duration-150" id="stockLength" min="1" step="0.01" type="number"/>
</label>
<div class="flex-grow"></div>
</div>
<div class="flex flex-col md:flex-row md:items-end space-y-4 md:space-y-0 md:space-x-6">
<label class="block text-gray-700 font-semibold md:w-1/3" for="pieceLength">
                    Piece Length:
                    <input class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition duration-150" id="pieceLength" min="1" step="0.01" type="number"/>
</label>
<label class="block text-gray-700 font-semibold md:w-1/3" for="quantity">
                    Quantity:
                    <input class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition duration-150" id="quantity" min="1" step="1" type="number"/>
</label>
<div class="flex md:w-1/3 space-x-2">
<button class="flex-grow px-4 py-2 bg-green-500 text-white font-bold rounded-lg shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out" onclick="addPiece()">
                        Add Piece
                    </button>
<button class="flex-grow px-4 py-2 bg-red-500 text-white font-bold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition duration-150 ease-in-out" onclick="clearAll()">
                        Clear All
                    </button>
</div>
</div>
<div class="piece-list mt-8">
<h3 class="text-xl font-bold text-gray-800 mb-2">Cut List</h3>
<ul class="bg-gray-50 p-4 rounded-lg border border-gray-200 min-h-[5rem] overflow-y-auto" id="cutListDisplay"></ul>
</div>
<div class="flex flex-col md:flex-row justify-center md:space-x-4 space-y-4 md:space-y-0">
<button class="w-full md:w-auto px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out" onclick="optimizeCuts()">
                    Optimize Cuts
                </button>
<button class="w-full md:w-auto px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-150 ease-in-out" onclick="exportPDF()">
                    Export to PDF
                </button>
</div>
<div class="bg-gray-50 p-4 rounded-lg mt-4 border border-gray-200" id="results"></div>
<canvas class="w-full max-w-full rounded-lg shadow-md border border-gray-200" id="diagramCanvas"></canvas>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
        const BLADE_KERF = 0.125;
        let cutPieces = [];

        function showMessage(message, type) {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.className = 'p-3 mb-4 text-center text-sm font-medium rounded-lg ';
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800');
            }
            messageBox.classList.remove('hidden');
        }

        function hideMessage() {
            const messageBox = document.getElementById('messageBox');
            messageBox.classList.add('hidden');
        }

        function addPiece() {
            hideMessage();
            const length = parseFloat(document.getElementById('pieceLength').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            if (length > 0 && quantity > 0) {
                cutPieces.push({ length, quantity });
                updateCutList();
                document.getElementById('pieceLength').value = '';
                document.getElementById('quantity').value = '';
            } else {
                showMessage("Please enter valid length and quantity.", "error");
            }
        }

        function updateCutList() {
            const list = document.getElementById('cutListDisplay');
            list.innerHTML = '';
            cutPieces.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.quantity} × ${item.length}"`;
                li.className = 'text-gray-700';
                list.appendChild(li);
            });
        }

        function clearAll() {
            hideMessage();
            document.getElementById('stockLength').value = '';
            document.getElementById('pieceLength').value = '';
            document.getElementById('quantity').value = '';
            cutPieces = [];
            updateCutList();
            document.getElementById('results').innerHTML = '';
            const canvas = document.getElementById('diagramCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            showMessage("All fields cleared.", "success");
        }

        function optimizeCuts() {
            hideMessage();
            const stockLength = parseFloat(document.getElementById('stockLength').value);
            if (stockLength <= 0 || cutPieces.length === 0) {
                showMessage("Please enter stock length and add cut pieces.", "error");
                return;
            }

            const allPieces = [];
            cutPieces.forEach(item => {
                for (let i = 0; i < item.quantity; i++) {
                    allPieces.push(item.length);
                }
            });
            allPieces.sort((a, b) => b - a);

            const boards = [];
            allPieces.forEach(piece => {
                let placed = false;
                for (let board of boards) {
                    const kerfCost = (board.length - 1) * BLADE_KERF;
                    const used = board.reduce((a, b) => a + b, 0) + kerfCost;
                    if (piece + BLADE_KERF <= stockLength - used) {
                        board.push(piece);
                        placed = true;
                        break;
                    }
                }
                if (!placed) {
                    boards.push([piece]);
                }
            });

            const totalOffcut = boards.reduce((sum, board) => {
                const used = board.reduce((a, b) => a + b, 0) + (board.length - 1) * BLADE_KERF;
                return sum + (stockLength - used);
            }, 0);

            document.getElementById('results').innerHTML = `
                <h3 class="text-xl font-bold text-gray-800">Optimization Results</h3>
                <p class="text-gray-700 mt-2">Boards Used: <span class="font-semibold">${boards.length}</span></p>
                <p class="text-gray-700">Total Offcut: <span class="font-semibold">${totalOffcut.toFixed(2)}"</span></p>
            `;

            drawDiagram(stockLength, boards);
        }

        function drawDiagram(stockLength, boards) {
            const canvas = document.getElementById('diagramCanvas');
            const ctx = canvas.getContext('2d');

            // Set canvas size based on parent container
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = boards.length * 60 + 100; // Dynamic height based on number of boards

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const scale = (canvas.width - 100) / stockLength;
            const boardHeight = 20;
            const spacing = 40;
            
            boards.forEach((board, i) => {
                let x = 50;
                let y = 50 + i * (boardHeight + spacing);

                // Draw the full stock board rectangle
                ctx.fillStyle = '#C2843A'; // Lighter brown for stock
                ctx.fillRect(x, y, stockLength * scale, boardHeight);
                ctx.strokeRect(x, y, stockLength * scale, boardHeight);

                // Draw the cut pieces
                let currentX = x;
                board.forEach((piece, j) => {
                    const pieceWidth = piece * scale;
                    ctx.fillStyle = '#8B4513'; // Darker brown for cut pieces
                    ctx.fillRect(currentX, y, pieceWidth, boardHeight);
                    
                    ctx.fillStyle = '#fff';
                    ctx.textAlign = 'center';
                    ctx.font = '12px "Inter", sans-serif';
                    ctx.fillText(`${piece}"`, currentX + pieceWidth / 2, y + boardHeight / 2 + 4);
                    
                    currentX += pieceWidth;

                    // Draw the kerf line
                    if (j < board.length - 1) {
                        const kerfWidth = BLADE_KERF * scale;
                        ctx.fillStyle = '#000';
                        ctx.fillRect(currentX, y, kerfWidth, boardHeight);
                        currentX += kerfWidth;
                    }
                });

                // Draw the offcut
                const used = board.reduce((a, b) => a + b, 0) + (board.length - 1) * BLADE_KERF;
                const offcut = stockLength - used;
                const offcutWidth = offcut * scale;
                ctx.fillStyle = '#A3B18A'; // Offcut color
                ctx.fillRect(currentX, y, offcutWidth, boardHeight);
                
                ctx.fillStyle = '#000';
                ctx.fillText(`Offcut (${offcut.toFixed(2)}")`, currentX + offcutWidth / 2, y + boardHeight / 2 + 4);
            });
        }
        
        function exportPDF() {
            hideMessage();
            const stockLength = parseFloat(document.getElementById('stockLength').value);
            if (stockLength <= 0 || cutPieces.length === 0) {
                showMessage("Please enter stock length and add cut pieces before exporting.", "error");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let y = 20;
            doc.setFontSize(18);
            doc.text("Wood Cutting Optimization Report", 10, y);
            y += 10;
            doc.setFontSize(12);
            doc.text(`Stock Board Length: ${stockLength}"`, 10, y);
            y += 10;
            doc.text("Cut Pieces:", 10, y);
            y += 10;
            cutPieces.forEach(item => {
                doc.text(`${item.quantity} × ${item.length}"`, 20, y);
                y += 10;
            });

            const allPieces = [];
            cutPieces.forEach(item => {
                for (let i = 0; i < item.quantity; i++) {
                    allPieces.push(item.length);
                }
            });
            allPieces.sort((a, b) => b - a);

            const boards = [];
            allPieces.forEach(piece => {
                let placed = false;
                for (let board of boards) {
                    const kerfCost = (board.length - 1) * BLADE_KERF;
                    const used = board.reduce((a, b) => a + b, 0) + kerfCost;
                    if (piece + BLADE_KERF <= stockLength - used) {
                        board.push(piece);
                        placed = true;
                        break;
                    }
                }
                if (!placed) {
                    boards.push([piece]);
                }
            });

            const totalOffcut = boards.reduce((sum, board) => {
                const used = board.reduce((a, b) => a + b, 0) + (board.length - 1) * BLADE_KERF;
                return sum + (stockLength - used);
            }, 0);

            y += 10;
            doc.text(`Boards Used: ${boards.length}`, 10, y);
            y += 10;
            doc.text(`Total Offcut: ${totalOffcut.toFixed(2)}"`, 10, y);
            y += 10;

            boards.forEach((board, i) => {
                if (y > 270) {
                    doc.addPage();
                    y = 10;
                }
                doc.setFontSize(12);
                doc.text(`Board ${i + 1}`, 10, y);
                y += 10;
                let x = 10;
                board.forEach((piece, j) => {
                    doc.setFillColor(139, 69, 19);
                    doc.rect(x, y, piece * 2, 10, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.text(`${piece}"`, x + piece, y + 5, { align: 'center' });
                    x += piece * 2;
                    if (j < board.length - 1) {
                        doc.setFillColor(0, 0, 0);
                        doc.rect(x, y, BLADE_KERF * 2, 10, 'F');
                        x += BLADE_KERF * 2;
                    }
                });
                const used = board.reduce((a, b) => a + b, 0) + (board.length - 1) * BLADE_KERF;
                const offcut = stockLength - used;
                doc.setFillColor(163, 177, 138);
                doc.rect(x, y, offcut * 2, 10, 'F');
                doc.setTextColor(0, 0, 0);
                doc.text(`Offcut (${offcut.toFixed(2)}")`, x + offcut, y + 5, { align: 'center' });
                y += 25;
            });

            doc.save("cutlist_report.pdf");
        }
        
        // Initial setup and resizing
        function setupCanvas() {
            const canvas = document.getElementById('diagramCanvas');
            const ctx = canvas.getContext('2d');
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            
            // Re-draw if there's data
            const stockLength = parseFloat(document.getElementById('stockLength').value);
            if (stockLength > 0 && cutPieces.length > 0) {
                // This will re-run the optimization and drawing
                optimizeCuts();
            }
        }
        
        window.addEventListener('resize', setupCanvas);
        window.addEventListener('onload', setupCanvas);
    </script>
</body>
</html>
